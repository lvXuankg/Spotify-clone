generator client {
  provider = "prisma-client"
  output   = "../../generated/prisma"
}

datasource db {
  provider = "postgresql"
  schemas  = ["auth_service", "catalog_service"]
}

model password_reset_tokens {
  id         String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  user_id    String    @db.Uuid
  token      String    @db.VarChar(255)
  expires_at DateTime  @db.Timestamptz(6)
  created_at DateTime? @default(now()) @db.Timestamptz(6)
  users      users     @relation(fields: [user_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@schema("auth_service")
}

model refresh_tokens {
  id         String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  user_id    String    @db.Uuid
  token_hash String
  expires_at DateTime  @db.Timestamptz(6)
  created_at DateTime? @default(now()) @db.Timestamptz(6)
  is_revoked Boolean?  @default(false)
  users      users     @relation(fields: [user_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@schema("auth_service")
}

model user_liked_artists {
  user_id    String    @db.Uuid
  artist_id  String    @db.Uuid
  created_at DateTime? @default(now()) @db.Timestamptz(6)
  users      users     @relation(fields: [user_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@id([user_id, artist_id])
  @@schema("auth_service")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model users {
  id                    String                  @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  username              String                  @unique @db.VarChar(50)
  email                 String                  @unique @db.VarChar(255)
  password_hash         String                  @db.VarChar(255)
  role                  String?                 @default("MEMBER") @db.VarChar(20)
  bio                   String?
  avatar_url            String?
  facebook_url          String?
  zalo_phone            String?                 @db.VarChar(20)
  description           String?
  created_at            DateTime?               @default(now()) @db.Timestamptz(6)
  updated_at            DateTime?               @default(now()) @db.Timestamptz(6)
  password_reset_tokens password_reset_tokens[]
  refresh_tokens        refresh_tokens[]
  user_liked_artists    user_liked_artists[]
  artist_followers      artist_followers[]
  artists               artists[]
  playlist_songs        playlist_songs[]
  playlists             playlists[]
  song_likes            song_likes[]
  user_saved_albums     user_saved_albums[]
  user_saved_artists    user_saved_artists[]
  user_saved_songs      user_saved_songs[]

  @@schema("auth_service")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model albums {
  id                String              @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  artist_id         String              @db.Uuid
  title             String              @db.VarChar(255)
  cover_url         String?
  release_date      DateTime?           @db.Date
  type              String?             @default("SINGLE") @db.VarChar(20)
  created_at        DateTime?           @default(now()) @db.Timestamptz(6)
  updated_at        DateTime?           @default(now()) @db.Timestamptz(6)
  artists           artists             @relation(fields: [artist_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  songs             songs[]
  user_saved_albums user_saved_albums[]

  @@schema("catalog_service")
}

model artist_followers {
  user_id    String    @db.Uuid
  artist_id  String    @db.Uuid
  created_at DateTime? @default(now()) @db.Timestamptz(6)
  artists    artists   @relation(fields: [artist_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  users      users     @relation(fields: [user_id], references: [id], onDelete: NoAction, onUpdate: NoAction)

  @@id([user_id, artist_id])
  @@schema("catalog_service")
}

model artists {
  id                 String               @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  user_id            String?              @db.Uuid
  display_name       String               @db.VarChar(100)
  avatar_url         String?
  cover_image_url    String?
  bio                String?
  created_at         DateTime?            @default(now()) @db.Timestamptz(6)
  updated_at         DateTime?            @default(now()) @db.Timestamptz(6)
  albums             albums[]
  artist_followers   artist_followers[]
  users              users?               @relation(fields: [user_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  song_artists       song_artists[]
  user_saved_artists user_saved_artists[]

  @@schema("catalog_service")
}

model genres {
  id          String        @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  name        String        @db.VarChar(50)
  slug        String        @unique @db.VarChar(50)
  song_genres song_genres[]

  @@schema("catalog_service")
}

model lyrics {
  id         String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  song_id    String?   @unique @db.Uuid
  content    Json
  created_at DateTime? @default(now()) @db.Timestamptz(6)
  updated_at DateTime? @default(now()) @db.Timestamptz(6)
  songs      songs?    @relation(fields: [song_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@schema("catalog_service")
}

model playlist_songs {
  id          String     @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  playlist_id String?    @db.Uuid
  song_id     String?    @db.Uuid
  added_by    String     @db.Uuid
  position    Int
  created_at  DateTime?  @default(now()) @db.Timestamptz(6)
  users       users      @relation(fields: [added_by], references: [id], onDelete: NoAction, onUpdate: NoAction)
  playlists   playlists? @relation(fields: [playlist_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  songs       songs?     @relation(fields: [song_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@schema("catalog_service")
}

model playlists {
  id             String           @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  user_id        String           @db.Uuid
  title          String           @db.VarChar(100)
  description    String?
  cover_url      String?
  is_public      Boolean?         @default(true)
  created_at     DateTime?        @default(now()) @db.Timestamptz(6)
  updated_at     DateTime?        @default(now()) @db.Timestamptz(6)
  playlist_songs playlist_songs[]
  users          users            @relation(fields: [user_id], references: [id], onDelete: NoAction, onUpdate: NoAction)

  @@schema("catalog_service")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model song_artists {
  id        String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  song_id   String?  @db.Uuid
  artist_id String?  @db.Uuid
  role      String?  @default("PRIMARY") @db.VarChar(20)
  artists   artists? @relation(fields: [artist_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  songs     songs?   @relation(fields: [song_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@schema("catalog_service")
}

model song_genres {
  song_id  String @db.Uuid
  genre_id String @db.Uuid
  genres   genres @relation(fields: [genre_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  songs    songs  @relation(fields: [song_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@id([song_id, genre_id])
  @@schema("catalog_service")
}

model song_likes {
  id         String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  song_id    String    @db.Uuid
  user_id    String    @db.Uuid
  created_at DateTime? @default(now()) @db.Timestamptz(6)
  songs      songs     @relation(fields: [song_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  users      users     @relation(fields: [user_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@unique([song_id, user_id])
  @@index([song_id], map: "idx_song_likes_song_id")
  @@index([user_id], map: "idx_song_likes_user_id")
  @@schema("catalog_service")
}

model songs {
  id               String             @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  album_id         String?            @db.Uuid
  title            String             @db.VarChar(255)
  duration_seconds Int
  audio_url        String
  track_number     Int?
  disc_number      Int?               @default(1)
  is_explicit      Boolean?           @default(false)
  bitrate          Int?
  play_count       BigInt?            @default(0)
  created_at       DateTime?          @default(now()) @db.Timestamptz(6)
  updated_at       DateTime?          @default(now()) @db.Timestamptz(6)
  lyrics           lyrics?
  playlist_songs   playlist_songs[]
  song_artists     song_artists[]
  song_genres      song_genres[]
  song_likes       song_likes[]
  albums           albums?            @relation(fields: [album_id], references: [id], onDelete: NoAction, onUpdate: NoAction)
  user_saved_songs user_saved_songs[]

  @@schema("catalog_service")
}

model user_saved_albums {
  user_id    String    @db.Uuid
  album_id   String    @db.Uuid
  created_at DateTime? @default(now()) @db.Timestamptz(6)
  albums     albums    @relation(fields: [album_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  users      users     @relation(fields: [user_id], references: [id], onDelete: NoAction, onUpdate: NoAction)

  @@id([user_id, album_id])
  @@schema("catalog_service")
}

model user_saved_artists {
  id         String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  user_id    String    @db.Uuid
  artist_id  String    @db.Uuid
  created_at DateTime? @default(now()) @db.Timestamptz(6)
  artists    artists   @relation(fields: [artist_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  users      users     @relation(fields: [user_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@unique([user_id, artist_id])
  @@schema("catalog_service")
}

model user_saved_songs {
  user_id    String    @db.Uuid
  song_id    String    @db.Uuid
  created_at DateTime? @default(now()) @db.Timestamptz(6)
  songs      songs     @relation(fields: [song_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  users      users     @relation(fields: [user_id], references: [id], onDelete: NoAction, onUpdate: NoAction)

  @@id([user_id, song_id])
  @@schema("catalog_service")
}
